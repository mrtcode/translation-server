AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: >-
  Lambda based translation-server to run Zotero translators ({{ node_env }})
Resources:
  # Lambda function
  Lambda:
    Type: 'AWS::Serverless::Function'
    Properties:
      CodeUri: ./
      Handler: src/lambda.handler
      Runtime: nodejs8.10
      MemorySize: 2048
      Timeout: 30
      #Policies:
      # - VPCAccessPolicy: {}
      Events:
        # API Gateway
        API:
          Type: Api
          Properties:
            # Proxy all POST requests to Lambda function
            Path: /{proxy+}
            Method: post
      #VpcConfig:
      #  SecurityGroupIds:
      #    - {{ security_group }}
      #  SubnetIds: {{ subnet_ids }}
      Environment:
        Variables:
          NODE_ENV: {{ node_env }}
Outputs:
  API:
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/"

